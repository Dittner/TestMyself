<?xml version="1.0"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009"
         xmlns:s="library://ns.adobe.com/flex/spark"
         xmlns:tile="de.dittner.testmyself.ui.common.tile.*"
         implements="de.dittner.testmyself.ui.common.menu.INoteToolbar">

    <fx:Metadata>
        [Event(name="selected", type="de.dittner.testmyself.ui.common.menu.ToolActionEvent")]
    </fx:Metadata>

    <fx:Script><![CDATA[
        import com.greensock.TweenLite;

        import de.dittner.testmyself.ui.common.audio.mp3.MP3Player;
        import de.dittner.testmyself.ui.common.tile.TileID;
        import de.dittner.testmyself.ui.common.utils.AppColors;
        import de.dittner.testmyself.ui.common.utils.AppSizes;
        import de.dittner.testmyself.utils.Values;

        public function revert():void {
            goBackBtn.enabled = false;
            addNoteBtn.enabled = false;
            editNoteBtn.enabled = false;
            removeNoteBtn.enabled = false;
            showDetailsBtn.enabled = false;
            transInvertBtn.enabled = false;
            filterBtn.enabled = false;
            setTaskAsRightBtn.enabled = false;
            showFailedTasksBtn.enabled = false;
            showDetailsBtn.selected = false;
            showFailedTasksBtn.selected = true;
            playCommentBtn.enabled = false;
            playCommentBtn.selected = false;
        }

        //--------------------------------------
        //  isShown
        //--------------------------------------
        private var _isShown:Boolean = false;
        [Bindable("isShownChanged")]
        public function get isShown():Boolean {return _isShown;}
        private function setIsShown(value:Boolean):void {
            if (_isShown != value) {
                _isShown = value;
                dispatchEvent(new Event("isShownChanged"));
            }
        }

        private var isAnimating:Boolean = false;
        private var hasPendingAnimation:Boolean = false;

        public function show():void {
            if (!isShown) {
                setIsShown(true);
                startAlphaAnimation();
            }
        }

        public function hide():void {
            if (isShown) {
                setIsShown(false);
                startAlphaAnimation();
            }
        }

        private function startAlphaAnimation():void {
            if (isAnimating) {
                hasPendingAnimation = true;
            }
            else {
                isAnimating = true;
                TweenLite.to(this, 0.3, {y: (isShown ? AppSizes.MENU_HEIGHT : 0), onComplete: animationComplete});
            }
        }

        private function animationComplete():void {
            isAnimating = false;
            if (hasPendingAnimation) {
                hasPendingAnimation = false;
                startAlphaAnimation();
            }
        }

        private function notifyToolAction(actionID:String):void {
            dispatchEvent(new ToolActionEvent(ToolActionEvent.SELECTED, actionID));
        }

        override protected function updateDisplayList(w:Number, h:Number):void {
            super.updateDisplayList(w, h);
            var g:Graphics = graphics;
            g.clear();
            g.beginFill(AppColors.TOOLBAR_BG);
            g.drawRect(0, 0, w, h);
            g.endFill();
        }

        //----------------------------------------------------------------------------------------------
        //
        //  Enable Buttons
        //
        //----------------------------------------------------------------------------------------------

        public function enableGoBack(value:Boolean = true):void {
            goBackBtn.enabled = value;
        }
        public function enableAddNote(value:Boolean = true):void {
            addNoteBtn.enabled = value;
        }
        public function enableEditNote(value:Boolean = true):void {
            editNoteBtn.enabled = value;
        }
        public function enableRemoveNote(value:Boolean = true):void {
            removeNoteBtn.enabled = value;
        }
        public function enableShowDetails(value:Boolean = true):void {
            showDetailsBtn.enabled = value;
        }
        public function enableTransInvert(value:Boolean = true):void {
            transInvertBtn.enabled = value;
        }
        public function enableFilter(value:Boolean = true):void {
            filterBtn.enabled = value;
        }
        public function enableShowFailedTasks(value:Boolean = true):void {
            showFailedTasksBtn.enabled = value;
        }
        public function enablesSetTaskAsRight(value:Boolean = true):void {
            setTaskAsRightBtn.enabled = value;
        }
        public function enablePlayCommentBtn(value:Boolean = true):void {
            playCommentBtn.enabled = value;
        }

        public function selectTransInvert(value:Boolean = true):void {
            transInvertBtn.selected = value;
        }
        public function selectShowDetails(value:Boolean = true):void {
            showDetailsBtn.selected = value;
        }
        public function selectShowFailedTasks(value:Boolean = true):void {
            showFailedTasksBtn.selected = value;
        }
        ]]></fx:Script>

    <tile:FadeTileButton id="goBackBtn"
                         visible="{goBackBtn.enabled}"
                         includeInLayout="{goBackBtn.enabled}"
                         upTileID="{TileID.TOOLBAR_GO_BACK}"
                         left="{Values.PT5}"
                         verticalCenter="0"
                         paddingLeft="{Values.PT40}"
                         paddingRight="0"
                         fontSize="{Values.PT18}"
                         textColor="0"
                         title="{resourceManager.getString('app', 'GoBack')}"
                         click="notifyToolAction(ToolAction.GO_BACK)"/>

    <s:HGroup height="100%" horizontalCenter="0" verticalAlign="middle" gap="{Values.PT15}">
        <tile:FadeTileButton id="addNoteBtn"
                             upTileID="{TileID.TOOLBAR_ADD}"
                             click="notifyToolAction(ToolAction.CREATE_NOTE)"/>

        <tile:FadeTileButton id="editNoteBtn"
                             upTileID="{TileID.TOOLBAR_EDIT}"
                             click="notifyToolAction(ToolAction.EDIT_NOTE)"/>

        <tile:FadeTileButton id="removeNoteBtn"
                             upTileID="{TileID.TOOLBAR_DELETE}"
                             click="notifyToolAction(ToolAction.REMOVE_NOTE)"/>

        <tile:FadeTileButton id="showDetailsBtn"
                             isToggle="true"
                             visible="{showDetailsBtn.enabled}"
                             includeInLayout="{showDetailsBtn.enabled}"
                             selected="false"
                             upTileID="{TileID.TOOLBAR_COLLAPSED_LIST}"
                             downTileID="{TileID.TOOLBAR_EXPANDED_LIST}"
                             selectedChange="notifyToolAction(showDetailsBtn.selected ? ToolAction.SHOW_DETAILS : ToolAction.HIDE_DETAILS)"
                             click="notifyToolAction(showDetailsBtn.selected ? ToolAction.SHOW_DETAILS : ToolAction.HIDE_DETAILS)"/>

        <tile:FadeTileButton id="transInvertBtn"
                             isToggle="true"
                             visible="{transInvertBtn.enabled}"
                             includeInLayout="{transInvertBtn.enabled}"
                             upTileID="{TileID.TOOLBAR_INVERSE_TRANSLATION}"
                             click="notifyToolAction(transInvertBtn.selected ? ToolAction.APPLY_INVERT : ToolAction.DENY_INVERT)"/>

        <tile:FadeTileButton id="filterBtn"
                             visible="{filterBtn.enabled}"
                             includeInLayout="{filterBtn.enabled}"
                             upTileID="{TileID.TOOLBAR_FILTER}"
                             click="notifyToolAction(ToolAction.FILTER)"/>

        <tile:FadeTileButton id="showFailedTasksBtn"
                             isToggle="true"
                             visible="{showFailedTasksBtn.enabled}"
                             includeInLayout="{showFailedTasksBtn.enabled}"
                             selected="true"
                             upTileID="{TileID.TOOLBAR_SHOW_ALL_TASK}"
                             downTileID="{TileID.TOOLBAR_SHOW_FAILED_TASK}"
                             click="notifyToolAction(showFailedTasksBtn.selected ? ToolAction.SHOW_FAILED_TASK : ToolAction.SHOW_ALL_TASK)"/>

        <tile:FadeTileButton id="setTaskAsRightBtn"
                             visible="{setTaskAsRightBtn.enabled}"
                             includeInLayout="{setTaskAsRightBtn.enabled}"
                             upTileID="{TileID.TOOLBAR_SET_TASK_AS_RIGHT}"
                             click="notifyToolAction(ToolAction.SET_TASK_AS_RIGHT)"/>
    </s:HGroup>

    <tile:FadeTileButton id="playCommentBtn"
                         isToggle="true"
                         upTileID="{TileID.TOOLBAR_PLAY_AUDIO}"
                         downTileID="{TileID.TOOLBAR_PLAY_AUDIO_SELECTED}"
                         visible="{playCommentBtn.enabled}"
                         right="{Values.PT2}"
                         verticalCenter="0"
                         deselectOnlyProgrammatically="true"
                         selected="{MP3Player.instance.isPlaying}"
                         change="if(playCommentBtn.selected) notifyToolAction(ToolAction.PLAY_COMMENT)"/>

</s:Group>
