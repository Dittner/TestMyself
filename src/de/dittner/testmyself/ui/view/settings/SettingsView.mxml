<?xml version="1.0"?>
<view:SmartView xmlns:fx="http://ns.adobe.com/mxml/2009"
                xmlns:s="library://ns.adobe.com/flex/spark"
                xmlns:core="de.dittner.testmyself.ui.common.view.*"
                xmlns:list="de.dittner.testmyself.ui.common.list.*"
                xmlns:utils="de.dittner.testmyself.ui.common.utils.*"
                xmlns:components="de.dittner.testmyself.ui.view.settings.components.*"
                horizontalCenter="0"
                currentState="inactive"
                xmlns:view="de.dittner.testmyself.ui.common.view.*">

    <fx:Script><![CDATA[
        import de.dittner.testmyself.ui.common.view.ViewModelFactory;
        import de.dittner.testmyself.ui.view.settings.components.SettingsInfo;
        import de.dittner.testmyself.utils.Values;

        [Bindable]
        public var vm:SettingsVM;

        private static const TAB_BAR_HEI:uint = Values.PT40;

        override protected function activating():void {
            vm = ViewModelFactory.instance.settingsVM;
            vm.lockView();
            toolbar.visible = toolbar.includeInLayout = false;
        }

        override protected function activate():void {
            vm.unlockView();
            vm.viewActivated(viewID);
            currentState = "common";
            tabBar.selectedIndex = 0;
            parseSettings(vm.settings);
        }

        private function parseSettings(settings:SettingsInfo):void {
            commonSettings.maxAudioRecordDurationSpinner.value = settings.maxAudioRecordDurationInMin;
            commonSettings.hostInput.text = settings.backUpServerInfo.host;
            commonSettings.portInput.text = settings.backUpServerInfo.port.toString();
            commonSettings.userNameInput.text = settings.backUpServerInfo.user;
            commonSettings.pwdInput.text = settings.backUpServerInfo.password;
            commonSettings.remoteDirInput.text = settings.backUpServerInfo.remoteDirPath;
        }

        public function clear():void {
            currentState = "inactive";
        }

        private function tabBar_selectedItemChangeHandler(event:Event):void {
            currentState = tabBar.selectedItem.state;
        }

        private function storeSettings():void {
            vm.storeSettings(commonSettings.getSettings());
        }

        override protected function deactivate():void {
            super.deactivate();
            vm.viewDeactivated();
            storeSettings();
        }
        ]]></fx:Script>

    <core:states>
        <s:State name="inactive"/>
        <s:State name="common"/>
        <s:State name="word"/>
        <s:State name="verb"/>
        <s:State name="lesson"/>
        <s:State name="test"/>
    </core:states>
    <!--content bg-->
    <s:Rect width="100%" height="100%">
        <s:fill>
            <s:BitmapFill source="@Embed(source='/assets/screen_bg_pattern.png')"
                          fillMode="repeat"/>
        </s:fill>
    </s:Rect>

    <utils:BG percentWidth="100" top="{PADDING + TAB_BAR_HEI}" bottom="0" fillColor="#ffFFff"/>

    <list:SelectableDataGroup id="tabBar"
                              excludeFrom="inactive"
                              left="{PADDING}" right="{PADDING}" height="{TAB_BAR_HEI}"
                              top="{PADDING}"
                              selectedItemChange="tabBar_selectedItemChangeHandler(event)"
                              itemRenderer="de.dittner.testmyself.ui.view.settings.components.SettingsItemRenderer">
        <list:dataProvider>
            <s:ArrayCollection>
                <fx:Object label="{resourceManager.getString('app', 'Common')}" state="common"/>
                <fx:Object label="{resourceManager.getString('app', 'Words')}" state="word"/>
                <fx:Object label="{resourceManager.getString('app', 'IrregularVerbs')}" state="verb"/>
                <fx:Object label="{resourceManager.getString('app', 'Lessons')}" state="lesson"/>
                <fx:Object label="{resourceManager.getString('app', 'Tests')}" state="test"/>
            </s:ArrayCollection>
        </list:dataProvider>
        <list:layout>
            <s:HorizontalLayout useVirtualLayout="false" gap="0" verticalAlign="bottom"/>
        </list:layout>
    </list:SelectableDataGroup>

    <s:Group left="{PADDING}" top="{2*PADDING + TAB_BAR_HEI}" right="{PADDING}" bottom="{PADDING}"
             excludeFrom="inactive">

        <components:CommonSettings id="commonSettings"
                                   vm="{vm}"
                                   width="100%" height="100%"
                                   visible.common="true" visible="false"/>

        <components:NoteSettings id="wordSettings"
                                 width="100%" height="100%"
                                 visible.word="true" visible="false"
                                 editLblText="{resourceManager.getString('app', 'EditNameOfTag')}"
                                 removeLblText="{resourceManager.getString('app', 'DeleteTag')}"
                                 tagsListTitle="{resourceManager.getString('app', 'Tags')}"
                                 notificationText="{resourceManager.getString('app', 'AreYouSureWantToDeleteThisTagWithoutTasks?')}"
                                 tagNameInputTitle="{resourceManager.getString('app', 'EnterNewNameOfTheTag')}"
                                 vocabulary="{vm.wordVocabulary}"/>

        <components:NoteSettings id="verbSettings"
                                 width="100%" height="100%"
                                 visible.verb="true" visible="false"
                                 editLblText="{resourceManager.getString('app', 'EditNameOfTag')}"
                                 removeLblText="{resourceManager.getString('app', 'DeleteTag')}"
                                 tagsListTitle="{resourceManager.getString('app', 'Tags')}"
                                 notificationText="{resourceManager.getString('app', 'AreYouSureWantToDeleteThisTagWithoutTasks?')}"
                                 tagNameInputTitle="{resourceManager.getString('app', 'EnterNewNameOfTheTag')}"
                                 vocabulary="{vm.verbVocabulary}"/>

        <components:NoteSettings id="lessonSettings"
                                 removeNotesByTagRemoving="true"
                                 width="100%" height="100%"
                                 visible.lesson="true" visible="false"
                                 editLblText="{resourceManager.getString('app', 'EditLessonName')}"
                                 removeLblText="{resourceManager.getString('app', 'DeleteLessonWithTasks')}"
                                 tagsListTitle="{resourceManager.getString('app', 'Lessons')}"
                                 notificationText="{resourceManager.getString('app', 'AreYouSureWantToDeleteThisLessonWithTasks?')}"
                                 tagNameInputTitle="{resourceManager.getString('app', 'EnterNewNameOfTheLesson')}"
                                 vocabulary="{vm.lessonVocabulary}"/>

        <components:TestSettings id="testSettings"
                                 testColl="{vm.allTestColl}"
                                 width="100%" height="100%"
                                 visible.test="true" visible="false"/>

    </s:Group>

</view:SmartView>
