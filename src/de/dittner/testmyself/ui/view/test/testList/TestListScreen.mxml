<?xml version="1.0"?>
<common:Container xmlns:fx="http://ns.adobe.com/mxml/2009"
                  xmlns:s="library://ns.adobe.com/flex/spark"
                  xmlns:list="de.dittner.testmyself.ui.common.list.*"
                  xmlns:common="de.dittner.testmyself.ui.common.*">

    <fx:Metadata>
        [Event(name="testSelected", type="flash.events.Event")]
    </fx:Metadata>

    <fx:Script><![CDATA[
        import de.dittner.testmyself.model.domain.test.Test;
        import de.dittner.testmyself.model.domain.vocabulary.Vocabulary;
        import de.dittner.testmyself.ui.view.test.TestVM;
        import de.dittner.testmyself.utils.Values;

        import mx.collections.ArrayCollection;

        import spark.events.IndexChangeEvent;

        //--------------------------------------
        //  vm
        //--------------------------------------
        private var _vm:TestVM;
        [Bindable("vmChanged")]
        public function get vm():TestVM {return _vm;}
        public function set vm(value:TestVM):void {
            if (_vm != value) {
                _vm = value;
                dispatchEvent(new Event("vmChanged"));
            }
        }

        //--------------------------------------
        //  padding
        //--------------------------------------
        private var _padding:Number = 0;
        [Bindable("paddingChanged")]
        public function get padding():Number {return _padding;}
        public function set padding(value:Number):void {
            if (_padding != value) {
                _padding = value;
                dispatchEvent(new Event("paddingChanged"));
            }
        }

        //----------------------------------------------------------------------------------------------
        //
        //  Methods
        //
        //----------------------------------------------------------------------------------------------

        public function activate():void {
            visible = true;
        }

        public function deactivate():void {
            visible = false;
        }

        private function getTestInfoList(vocabulary:Vocabulary):ArrayCollection {
            return new ArrayCollection(vocabulary ? vocabulary.availableTests : []);
        }

        private function selectedTestHandler(event:IndexChangeEvent):void {
            if (testList.selectedItem is Test) {
                vm.testPage.test = testList.selectedItem;
                vm.selectedVocabulary = vocabularyList.selectedItem;
                dispatchEvent(new Event("testSelected"));
                testList.selectedItem = null;
            }
        }
        ]]></fx:Script>

    <s:Rect width="100%" height="100%">
        <s:fill>
            <s:BitmapFill source="@Embed(source='/assets/screen_bg_pattern.png')"
                          fillMode="repeat"/>
        </s:fill>
    </s:Rect>

    <list:ListForm id="vocabularyList"
                   verticalScrollPolicy="off"
                   horizontalScrollPolicy="off"
                   left="{padding}" right="{padding}"
                   top="{padding}"
                   dataProvider="{vm.vocabularyColl}"
                   title="{resourceManager.getString('app', 'PleaseChooseTheDesiredNoteType')}"
                   itemRenderer="de.dittner.testmyself.ui.view.test.testList.VocabularyRenderer">
        <list:layout>
            <s:VerticalLayout gap="0" useVirtualLayout="false"/>
        </list:layout>
    </list:ListForm>

    <list:ListForm id="testList"
                   visible="{vocabularyList.selectedItem}"
                   verticalScrollPolicy="off"
                   horizontalScrollPolicy="off"
                   left="{padding}" right="{padding}"
                   top="{padding + vocabularyList.height + Values.PT15}" bottom="{padding}"
                   dataProvider="{getTestInfoList(vocabularyList.selectedItem)}"
                   title="{resourceManager.getString('app', 'PleaseChooseTheDesiredTest')}"
                   itemRenderer="de.dittner.testmyself.ui.view.test.testList.TestInfoRenderer"
                   change="selectedTestHandler(event)">
        <list:layout>
            <s:VerticalLayout gap="0" useVirtualLayout="false"/>
        </list:layout>
    </list:ListForm>

</common:Container>
